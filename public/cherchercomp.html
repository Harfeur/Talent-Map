<!doctype html>
<html>
<meta charset="utf-8">
<title>Chercher une compétence</title>
<meta name="description" content="???">
<link rel="stylesheet" type="text/css" href="/packages/bootstrap/dist/css/bootstrap.css" />
<script src="/packages/jquery/dist/jquery.min.js"></script>
<script src="/packages/angular/angular.min.js"></script>
<script src="/packages/bootstrap/dist/js/bootstrap.js"></script>
</head>

<body ng-app="gpecApp" ng-controller="controleur">
  <div class="container">
    <h1>Chercher une compétence</h1>
    <div class="tab-content" id="myTabContent">
      <div class="tab-pane fade show active" id="jquery" role="tabpanel" aria-labelledby="jquery-tab">

        <form class="form-inline">
          <div class="form-group">
            <label for="listeComp">Compétence recherchée</label>
            <select class="form-control" id="listeComp">
            </select>
          </div>
          <div class="form-group">
            <div class="form-group">
              <label for="pourcent">Pourcentage minimum</label>
              <select class="form-control" id="pourcent">
                <option pourc="25">Peu important</option>
                <option pourc="50">Important</option>
                <option pourc="75">Très important</option>
              </select>
            </div>
          </div>
          <button type="submit" class="btn btn-primary" id="recherche">Rechercher</button>
        </form>
        <table id="tabResul" class="table">
        </table>
      </div>
    </div>
  </div>
</body>
<script>
  //either use jQuery or AngularJS...
  $(document).ready(function () {
    $.ajax({
      method: 'GET',
      url: 'listeCompetences/',
      dataType: 'json',
      success: function (data) {
        (data).forEach(function (d, i) {
          $('#listeComp').append(`<OPTION data-id=${d.id}> ${d.libelle} </OPTION>`);
        });
      },
      error: function (x, error) {
        console.log(error);
      }
    });

    $("#recherche").click(function (e) {
      e.preventDefault();
      $('#tabResul').html("");
      $.ajax({
        method: 'GET',
        url: 'personnelCompetence/',
        dataType: 'json',
        data: {
          "id": $('#listeComp option:selected').attr('data-id'),
          "pourcent": Number($('#pourcent option:selected').attr('pourc'))
        },
        success: function (data) {
          (data).forEach(function (d, i) {
            $('#tabResul').append(`<tr><td> ${d.nom} : ${d.pourcentAcquis}% </td></tr>`);
          });
        },
        error: function (x, error) {
          console.log(error);
        }
      });
    });
  });
</script>

</html>